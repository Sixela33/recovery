import{a as r}from"./chunk-EXOBHYDO.js";import{a as m}from"./chunk-SGGYT3KY.js";import{a as n,b as o,d as v,e as i}from"./chunk-2NN7LKDP.js";import{z as a}from"zod";var c=class p extends r{constructor(t,e){let E=n(n({},e==null?void 0:e.incomingEvents),s.fromParent),h=n(n({},e==null?void 0:e.outgoingEvents),s.fromChild);super(t,E,h);this.isConnected=!1;this.handshakeOptions=n(n({},d),e==null?void 0:e.handshakeOptions)}handshakeWithParent(){return i(this,null,function*(){if(this.isConnected){console.log("[client] Already connected to parent");return}let{requestVerificationId:t}=yield this._onAction({event:"handshakeRequest",callback:e=>e,responseEvent:"handshakeResponse",options:{timeoutMs:this.handshakeOptions.timeoutMs}});yield this._onAction({event:"handshakeComplete",options:{timeoutMs:this.handshakeOptions.timeoutMs,condition:e=>e.requestVerificationId===t}}),this.isConnected=!0})}_onAction(t){return i(this,null,function*(){return yield v(p.prototype,this,"onAction").call(this,o(n({},t),{options:t.options}))})}};var d={timeoutMs:1e4,intervalMs:100},s={fromChild:{handshakeResponse:a.object({requestVerificationId:a.string()})},fromParent:{handshakeRequest:a.object({requestVerificationId:a.string()}),handshakeComplete:a.object({requestVerificationId:a.string()})}};var f=class extends r{constructor(t,e){let E=n(n({},e==null?void 0:e.incomingEvents),s.fromChild),h=n(n({},e==null?void 0:e.outgoingEvents),s.fromParent);super(t,E,h);this.isConnected=!1;this.handshakeOptions=n(n({},d),e==null?void 0:e.handshakeOptions)}handshakeWithChild(){return i(this,null,function*(){if(this.isConnected){console.log("[server] Already connected to child");return}let t=m();yield this._sendAction({event:"handshakeRequest",data:{requestVerificationId:t},responseEvent:"handshakeResponse",options:{timeoutMs:this.handshakeOptions.timeoutMs,intervalMs:this.handshakeOptions.intervalMs,condition:e=>e.requestVerificationId===t}}),this._send("handshakeComplete",{requestVerificationId:t}),this.isConnected=!0})}_send(t,e){return super.send(t,e)}_sendAction(t){return super.sendAction(o(n({},t),{options:t.options}))}};export{f as a,d as b,s as c,c as d};
