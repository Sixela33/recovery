"use strict";Object.defineProperty(exports, "__esModule", {value: true});var _chunkNIHEG35Icjs = require('./chunk-NIHEG35I.cjs');var f=class{constructor(t,n,s){this.transport=t,this.incomingEvents=n,this.outgoingEvents=s}send(t,n){let s=this.outgoingEvents[t].safeParse(n);s.success?this.transport.send({event:t,data:n}):console.error("Invalid data for event",t,s.error)}on(t,n){let s=e=>{if(e.data.event===t){let i=this.incomingEvents[t].safeParse(e.data.data);i.success?n(i.data):console.error("Invalid data for event",t,i.error)}};return this.transport.addMessageListener(s)}sendAction({event:t,data:n,responseEvent:s,options:e}){var r;let i=(r=e==null?void 0:e.timeoutMs)!=null?r:7e3;return new Promise((c,v)=>{let g,E=setTimeout(()=>{v(`Timed out waiting for ${String(s)} event${e!=null&&e.condition?", with condition,":""} after ${i/1e3}s`)},i),a=this.on(s,o=>{e!=null&&e.condition&&!e.condition(o)||(g&&clearInterval(g),clearTimeout(E),this.off(a),c(o))});this.send(t,n),e!=null&&e.intervalMs&&(g=setInterval(()=>this.send(t,n),e==null?void 0:e.intervalMs))})}onAction(e){return _chunkNIHEG35Icjs.e.call(void 0, this,null,function*(){var i=e,{event:t,options:n}=i,s=_chunkNIHEG35Icjs.c.call(void 0, i,["event","options"]);var c;let r=(c=n==null?void 0:n.timeoutMs)!=null?c:7e3;return new Promise((v,g)=>{let E=setTimeout(()=>{g(`Timed out waiting for ${String(t)} event${n!=null&&n.condition?", with condition,":""} after ${r/1e3}s`)},r),a=this.on(t,o=>{if(!(n!=null&&n.condition&&!n.condition(o))){if("callback"in s&&s.callback!=null){let m=s.callback(o);this.send(s.responseEvent,m)}this.off(a),clearTimeout(E),v(o)}})})})}off(t){this.transport.removeMessageListener(t)}};exports.a = f;
