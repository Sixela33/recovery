"use strict";Object.defineProperty(exports, "__esModule", {value: true});var _chunkOVCZB5VUcjs = require('./chunk-OVCZB5VU.cjs');var _chunkCK4JCQY6cjs = require('./chunk-CK4JCQY6.cjs');var _react = require('react');var _walletssdk = require('@crossmint/wallets-sdk');function X(){let s=_react.useContext.call(void 0, y);if(!s)throw new Error("useWallet must be used within CrossmintWalletProvider");return s}var _jsxruntime = require('react/jsx-runtime');var y=_react.createContext.call(void 0, {wallet:void 0,status:"not-loaded",getOrCreateWallet:()=>Promise.resolve(void 0),onAuthRequired:void 0,clientTEEConnection:void 0});function re({children:s,createOnLogin:o,callbacks:r,onAuthRequired:a,clientTEEConnection:i}){let{crossmint:P,experimental_customAuth:e}=_chunkOVCZB5VUcjs.a.call(void 0, "CrossmintWalletBaseProvider must be used within CrossmintProvider"),[d,C]=_react.useState.call(void 0, void 0),[l,u]=_react.useState.call(void 0, "not-loaded"),f=_react.useCallback.call(void 0, n=>_chunkCK4JCQY6cjs.c.call(void 0, this,null,function*(){var S,v,x,E,R,c,q,B,F,O,b,H;if(!((e==null?void 0:e.jwt)==null||l==="in-progress")){if(d!=null)return d;try{u("in-progress");let p=_walletssdk.CrossmintWallets.from(P),g=(v=(S=n.options)==null?void 0:S.experimental_callbacks)==null?void 0:v.onWalletCreationStart,W=(E=(x=n.options)==null?void 0:x.experimental_callbacks)==null?void 0:E.onTransactionStart;if(((R=n==null?void 0:n.signer)==null?void 0:R.type)==="email"){let t=(c=n.signer.email)!=null?c:e==null?void 0:e.email,m=(q=n.signer.onAuthRequired)!=null?q:a;if(t==null)throw new Error("Email not found in experimental_customAuth or signer. Please set email in experimental_customAuth or signer.");n.signer=_chunkCK4JCQY6cjs.b.call(void 0, _chunkCK4JCQY6cjs.a.call(void 0, {},n.signer),{email:t,onAuthRequired:m})}if(((B=n==null?void 0:n.signer)==null?void 0:B.type)==="phone"){let t=(F=n.signer.phone)!=null?F:e==null?void 0:e.phone,m=(O=n.signer.onAuthRequired)!=null?O:a;if(t==null)throw new Error("Phone not found in signer. Please set phone in signer.");n.signer=_chunkCK4JCQY6cjs.b.call(void 0, _chunkCK4JCQY6cjs.a.call(void 0, {},n.signer),{phone:t,onAuthRequired:m})}if(((b=n==null?void 0:n.signer)==null?void 0:b.type)==="external-wallet"){let t=((H=n.signer)==null?void 0:H.address)!=null?n.signer:e.externalWalletSigner;if(t==null)throw new Error("External wallet config not found in experimental_customAuth or signer. Please set it in experimental_customAuth or signer.");n.signer=t}let I=yield p.getOrCreateWallet({chain:n.chain,signer:n.signer,owner:n.owner,plugins:n.plugins,delegatedSigners:n.delegatedSigners,options:{clientTEEConnection:i==null?void 0:i(),experimental_callbacks:{onWalletCreationStart:g!=null?g:r==null?void 0:r.onWalletCreationStart,onTransactionStart:W!=null?W:r==null?void 0:r.onTransactionStart}}});return C(I),u("loaded"),I}catch(p){console.error("Failed to create wallet:",p),C(void 0),u("error");return}}}),[P,e]);_react.useEffect.call(void 0, ()=>{if(o!=null){if(o.signer.type==="email"&&(e==null?void 0:e.email)==null||o.signer.type==="external-wallet"&&(e==null?void 0:e.externalWalletSigner)==null&&o.signer.address==null)return;f(o)}},[o,f,e==null?void 0:e.email,e==null?void 0:e.externalWalletSigner]),_react.useEffect.call(void 0, ()=>{(e==null?void 0:e.jwt)==null&&l!=="not-loaded"&&(u("not-loaded"),C(void 0))},[e==null?void 0:e.jwt,l]);let k=_react.useMemo.call(void 0, ()=>({wallet:d,status:l,getOrCreateWallet:f,onAuthRequired:a,clientTEEConnection:i}),[f,d,l,a,i]);return _jsxruntime.jsx.call(void 0, y.Provider,{value:k,children:s})}exports.a = y; exports.b = re; exports.c = X;
